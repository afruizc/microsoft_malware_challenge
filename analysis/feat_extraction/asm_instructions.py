
# coding: utf-8

# ## extracting assembly instruction sequences
# ### Aaron Gonzales

import asm_utils


samples = asm_utils.get_collection()

with open('asm_instructions.csv', 'r') as f:
    asm_instr = [line.strip() for line in f.readlines()]


def make_asm_info(post):
    """Takes a mongodb post and inserts information about it's assembly
        code in it"""
    asm = asm_utils.read_assembly(post['id'])
    instr_seq = asm_utils.get_inst(asm, asm_instr)
    post['asm_info'] = asm_utils.asm_seq_info(instr_seq)
    samples.save(post)


documents = samples.find()



for doc in documents:
    if 'asm_info' in doc.keys():
        print('extracting assembly info for %s' % doc['id'])
        make_asm_info(doc)
    else:
        print('%s already has extracted information' % doc['id'])
